<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="layui/css/layui.css" media="all">
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
</head>
<body>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
    <legend>按条件查询个人信息</legend>
</fieldset>
<form class="layui-form" action="" lay-filter="example">

<!--    <div class="layui-form-item">
        <div class="layui-input-block">
            <input id="eId" type="hidden" name="eId" lay-verify="title" autocomplete="off" class="layui-input">
        </div>
    </div> -->
	
	    <div class="layui-inline">
	      <label class="layui-form-label">搜索选择框</label>
	      <div class="layui-input-inline">
	        <select name="selectType" lay-verify="required" lay-search="">
	          <option value="">直接选择或搜索选择</option>
	          <option value="1">按身份证查询</option>
	          <option value="2">按姓名查询</option>
	          <option value="3">按学科查询</option>
	        </select>
	      </div>
	    </div>
	  </div>

      <div class="layui-form-item">
          <label class="layui-form-label">请输入内容</label>
          <div class="layui-input-block">
            <input type="text" name="condition" lay-verify="title" autocomplete="off" placeholder="请输入.." class="layui-input">
          </div>
        </div>

	  <div class="layui-form-item">
		<div class="layui-input-block">
		  <button type="submit" class="layui-btn" lay-submit="" lay-filter="demo11">点击查询</button>
		</div>
	  </div>
	  <table class="layui-hide" id="test" lay-filter="test"></table>

		<script type="text/html" id="barDemo">
			<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
			<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
		</script>
  
</form>
    <script src="layui/layui.js" charset="utf-8"></script>
    <!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
    <script>
        layui.use(['form', 'layedit','jquery','table', 'layer'], function () {
            var form = layui.form
                , layer = layui.layer
                , layedit = layui.layedit
                , laydate = layui.laydate;
			var table = layui.table;
            var $ = layui.jquery
                , upload = layui.upload;
            // //创建一个编辑器
            // var editIndex = layedit.build('LAY_demo_editor');

            // alert("---")
            var $ = layui.$ //重点处
                ,layer = layui.layer;
            //后面就跟你平时使用jQuery一样

            //监听提交
            form.on('submit(demo11)', function (data) {
                // layer.alert(JSON.stringify(data.field), {
                //     title: '最终的提交信息'
                // })

				table.render({
					elem: '#test'
					,url:'examnieeInfo/selectExamnieeInfo.do'
					,where:{selectType:data.field.selectType,condition:data.field.condition}
					,toolbar: '#toolbarDemo' //开启头部工具栏，并为其绑定左侧模板
					,defaultToolbar: ['filter', 'exports', 'print', { //自定义头部工具栏右侧图标。如无需自定义，去除该参数即可
						title: '提示'
						,layEvent: 'LAYTABLE_TIPS'
						,icon: 'layui-icon-tips'
					}]
					,title: '考生信息表'
					,cols: [[
						{type: 'checkbox', fixed: 'left'}
						,{field:'eId', title:'ID', width:80, fixed: 'left', unresize: true, sort: true,hide:true}
						,{field:'examnieeId', title:'身份证号', width:220, edit: 'text',sort:true}
						,{field:'examnieeName', title:'考生姓名', width:80, edit: 'text', sort: true}
						,{field:'examnieeSex', title:'性别', width:100}
						,{field:'examnieePhoto', title:'照片',sort:true,templet:'<div><img src="{{d.examnieePhoto}}"></div>'}
						,{field:'examnieeSubjectId', title:'学科号', width:80, sort: true}
						,{field:'subject', title:'学科名', width:80, sort: true,templet:'<div>{{d.subject.subjectName}}</div>'}
						,{fixed: 'right', title:'操作', toolbar: '#barDemo', width:150}
					]]
					,page: true
				});

                // layui.$.ajax({
                //     type:"post",
                //     url:"examnieeInfo/selectExamnieeInfo.do",
                //     data:data.field,
                //     success:function (res) {
                //         if (res.code == 0){
                //             alert("查询成功!");
                //             alert(res.data);
                //             // parent.GetValue(res.data);
                //             var index=parent.layer.getFrameIndex(window.name); //获取当前窗口的name
                //             parent.layer.close(index);
                //             // window.parent.location.reload();
                //         } else if(res.code > 0){
                //             alert("操作失败")
                //         }
                //     }
                // })
                return false;
            });
			var $ = layui.$,active = {
				getCheckData:function () {
					var checkStatus = table.checkStatus('deleteAllNode'),data = checkStatus.data;
					if (data == ""){
						layer.msg("请选择要删除的数据",{icon:2});
						return;
					}
					var ids = "";
					if (data.length>0){
						for (var i = 0;i<data.length;i++){
							ids += data[i].id+",";
						}
					}
					alert(ids);
				}
			}

			//头工具栏事件
			table.on('toolbar(test)', function(obj){
				var checkStatus = table.checkStatus(obj.config.id);
				switch(obj.event){
					case 'getCheckData':
						var data = checkStatus.data;
						layer.alert(JSON.stringify(data));
						break;
					case 'getCheckLength':
						var data = checkStatus.data;
						layer.msg('选中了：'+ data.length + ' 个');
						break;
					case 'isAll':
						layer.msg(checkStatus.isAll ? '全选': '未全选');
						break;
					case 'doDelAll':
						// alert("---");
						var ids = "";
						// for (var i = 0;i<checkStatus.data.length;i++){
						//   alert(JSON.stringify(checkStatus.data[i].eId));
						// }
						layui.$.ajax({
							type:"post",
							url:"examnieeInfo/examnieeInfoDelAll.do",
							data:JSON.stringify(checkStatus.data),
							contentType:"application/json",
							success:function (res) {
								if (res.code == 0){
									alert("操作成功");
									var index=parent.layer.getFrameIndex(window.name); //获取当前窗口的name
									parent.layer.close(index);
									window.parent.location.reload();
								} else if (res.code!=0) {
									alert(res.msg);
									var index=parent.layer.getFrameIndex(window.name); //获取当前窗口的name
									parent.layer.close(index);
								}
							}
						})
						break;

						//自定义头工具栏右侧图标 - 提示
					case 'LAYTABLE_TIPS':
						layer.alert('下次等级考试时间在19/12/6日开始，请在11月前提交考生报名信息');
						break;
				};
			});

			//监听行工具事件
			table.on('tool(test)', function(obj){
				var data = obj.data;
				//console.log(obj);
				if(obj.event === 'del'){
					layer.confirm('真的删除行么', function(index){
						// alert(index);
						obj.del();
						layer.close(index);
						layui.$.ajax({
							type:"post",
							url:"examnieeInfo/examnieeInfoDel.do",
							data:data,
							datatype:"json",
							success:function (data) {
								if (data.code=0);
								alert(data.msg);
							}
						})
					});
				} else if(obj.event === 'edit'){
					layer.open({
						title:"修改考生信息",
						type: 2,
						area: ['800px', '650px'],
						fixed: false, //不固定
						maxmin: true,
						content: 'updateExamnieeInfo.html',
						success:function (layero,index) {
							var body =layui.layer.getChildFrame('body',index);
							if (data){
								body.find("#eId").val(data.eId);
								body.find("#examnieeName").val(data.examnieeName);
								body.find("#examnieeId").val(data.examnieeId);
								// alert(data.examnieeSex == '男')
								// alert(data.examnieeSex)
								if (data.examnieeSex == '男'){
									body.find("#man").attr({checked:true});
								}else
									body.find("#woman").attr({checked:true});
								body.find("#examnieePhoto").val(data.examnieePhoto);
								body.find("#subjectId").val(data.examnieeSubjectId);

								form.render();
							}
							setTimeout(function(){
								layui.layer.tips('点击此处返回考生列表', '.layui-layer-setwin .layui-layer-close', {
									tips: 3
								});
							},500)
						}
					});
				}
			});
			//表单取值
			// layui.$('#LAY-component-form-getval').on('click', function(){
			//   var data = form.val('example');
			//   alert(JSON.stringify(data));
			// });
        });
    </script>
</body>
</html>
